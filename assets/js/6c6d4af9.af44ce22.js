"use strict";(globalThis.webpackChunkvectordocs=globalThis.webpackChunkvectordocs||[]).push([[1094],{7335(e,n,t){t.d(n,{A:()=>o});const o=t.p+"assets/images/bgp-topology-diagram-f9739a4a3d06719349a0247521c29a98.jpg"},8453(e,n,t){t.d(n,{R:()=>s,x:()=>c});var o=t(6540);const r={},i=o.createContext(r);function s(e){const n=o.useContext(i);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),o.createElement(i.Provider,{value:n},e.children)}},8989(e,n,t){t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"routing/bgp/local_preference/index","title":"Local Preference","description":"Local Preference Power","source":"@site/docs/routing/bgp/local_preference/index.md","sourceDirName":"routing/bgp/local_preference","slug":"/routing/bgp/local_preference","permalink":"/VectorDocs/docs/routing/bgp/local_preference","draft":false,"unlisted":false,"editUrl":"https://github.com/ngeran/VectorDocs/tree/main/docs/routing/bgp/local_preference/index.md","tags":[{"inline":true,"label":"BGP","permalink":"/VectorDocs/docs/tags/bgp"},{"inline":true,"label":"Routing","permalink":"/VectorDocs/docs/tags/routing"},{"inline":true,"label":"Juniper","permalink":"/VectorDocs/docs/tags/juniper"},{"inline":true,"label":"Attributes","permalink":"/VectorDocs/docs/tags/attributes"}],"version":"current","frontMatter":{"slug":"/routing/bgp/local_preference","title":"Local Preference","date":"2024-12-12T22:30:21.000Z","draft":false,"tags":["BGP","Routing","Juniper","Attributes"],"featured_image":"featured.png","summary":"The Power of Local Preference. The first BGP attribute used to favor one route over another."},"sidebar":"docsSidebar","previous":{"title":"Finite State Machine","permalink":"/VectorDocs/docs/routing/bgp/fsm"},"next":{"title":"Type 1 - Router LSA","permalink":"/VectorDocs/docs/routing/ospf/lsa1"}}');var r=t(4848),i=t(8453);const s={slug:"/routing/bgp/local_preference",title:"Local Preference",date:new Date("2024-12-12T22:30:21.000Z"),draft:!1,tags:["BGP","Routing","Juniper","Attributes"],featured_image:"featured.png",summary:"The Power of Local Preference. The first BGP attribute used to favor one route over another."},c=void 0,a={},l=[{value:"Local Preference Power",id:"local-preference-power",level:3},{value:"Topology",id:"topology",level:3},{value:"Initial set up",id:"initial-set-up",level:3},{value:"Configuration",id:"configuration",level:3},{value:"The Result",id:"the-result",level:3},{value:"Advertise to eBGP (non-transitive)",id:"advertise-to-ebgp-non-transitive",level:3}];function d(e){const n={blockquote:"blockquote",br:"br",code:"code",h3:"h3",img:"img",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h3,{id:"local-preference-power",children:"Local Preference Power"}),"\n",(0,r.jsxs)(n.p,{children:["Local preference is the highest tiebreaker in the BGP path selection process. If a BGP next hop is reachable and BGP knows multiple routes, BGP always chooses the route with the highest local preference to exit the AS.",(0,r.jsx)(n.br,{}),"\n","The local preference is a ",(0,r.jsx)(n.strong,{children:"well-known"}),", ",(0,r.jsx)(n.strong,{children:"discretionary"})," attribute, which means it must be supported by all BGP-speaking neighbors but does not have to be included in the BGP update message.",(0,r.jsx)(n.br,{}),"\n","Local preference is also ",(0,r.jsx)(n.strong,{children:"non-transitive"}),", meaning it stays within its own internal AS and cannot be advertised to an external BGP neighbor."]}),"\n",(0,r.jsx)(n.p,{children:"Let's now see how to configure and influance traffic with Local Preference."}),"\n",(0,r.jsx)(n.h3,{id:"topology",children:"Topology"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Taken from Juniper vLabs"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"BGP Topology",src:t(7335).A+"",width:"919",height:"436"})}),"\n",(0,r.jsx)(n.h3,{id:"initial-set-up",children:"Initial set up"}),"\n",(0,r.jsxs)(n.p,{children:["vMX5 advertises the same route ",(0,r.jsx)(n.strong,{children:"192.168.235.0/24"})," to both vMX3 and vMX2."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"jcluser@vMX5# run show route advertising-protocol bgp 10.100.25.1 \n\ninet.0: 16 destinations, 16 routes (16 active, 0 holddown, 0 hidden)\n  Prefix  Nexthop       MED     Lclpref    AS path\n* 192.168.235.0/24        Self                                    I\n\n[edit]\njcluser@vMX5# run show route advertising-protocol bgp 10.100.35.1    \n\ninet.0: 16 destinations, 16 routes (16 active, 0 holddown, 0 hidden)\n  Prefix  Nexthop       MED     Lclpref    AS path\n* 192.168.235.0/24        Self                                    I\n"})}),"\n",(0,r.jsxs)(n.p,{children:["vMX1 learns the same route from vMX2 and vMX3. Goes throught the Best Path Selection",(0,r.jsx)(n.br,{}),"\n","process and chooses the route from vMX2 because of the lower ",(0,r.jsx)(n.strong,{children:"Router ID"}),".",(0,r.jsx)(n.br,{}),"\n",'In this case both neighbors advertise the route with the "Localpref" of ',(0,r.jsx)(n.strong,{children:"100"})," which is the ",(0,r.jsx)(n.strong,{children:"default"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"jcluser@vMX1# run show route 192.168.235.0/24 exact detail \n\ninet.0: 13 destinations, 14 routes (13 active, 0 holddown, 0 hidden)\n192.168.235.0/24 (2 entries, 1 announced)\n        *BGP    Preference: 170/-101\n                Next hop type: Indirect, Next hop index: 0\n                Address: 0xc4b5dbc\n                Next-hop reference count: 2\n                Source: 10.100.100.2\n                Next hop type: Router, Next hop index: 343\n                Next hop: 100.123.0.1 via fxp0.0, selected\n                Session Id: 0x0\n                Protocol next hop: 10.100.25.2\n                Indirect next hop: 0xc61de84 347 INH Session ID: 0x0\n                State: <Active Int Ext>\n                Local AS: 64522 Peer AS: 64522\n                Age: 8:04 Metric2: 0 \n                Validation State: unverified \n                Task: BGP_64522.10.100.100.2\n                Announcement bits (2): 0-KRT 5-Resolve tree 1 \n                AS path: 64544 I \n                Accepted\n                Localpref: 100\n                Router ID: 10.100.100.2\n                Thread: junos-main \n         BGP    Preference: 170/-101\n                Next hop type: Indirect, Next hop index: 0\n                Address: 0xc4b5e8c\n                Next-hop reference count: 1\n                Source: 10.100.100.3\n                Next hop type: Router, Next hop index: 343\n                Next hop: 100.123.0.1 via fxp0.0, selected\n                Session Id: 0x0\n                Protocol next hop: 10.100.35.2\n                Indirect next hop: 0xc61e004 - INH Session ID: 0x0\n                State: <NotBest Int Ext Changed>\n                Inactive reason: Not Best in its group - Router ID\n                Local AS: 64522 Peer AS: 64522\n                Age: 8:04 Metric2: 0 \n                Validation State: unverified \n                Task: BGP_64522.10.100.100.3\n                AS path: 64544 I \n                Accepted\n                Localpref: 100\n                Router ID: 10.100.100.3\n                Thread: junos-main \n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"jcluser@vMX3# run show route protocol bgp   \n\ninet.0: 17 destinations, 18 routes (17 active, 0 holddown, 0 hidden)\n+ = Active Route, - = Last Active, * = Both\n\n192.168.235.0/24   *[BGP/170] 00:20:44, localpref 100\n                      AS path: 64544 I, validation-state: unverified\n                    >  to 10.100.35.2 via ge-0/0/0.0\n                    [BGP/170] 00:20:43, localpref 100, from 10.100.100.2\n                      AS path: 64544 I, validation-state: unverified\n                    >  to 100.123.0.1 via fxp0.0\n"})}),"\n",(0,r.jsx)(n.h3,{id:"configuration",children:"Configuration"}),"\n",(0,r.jsxs)(n.p,{children:["Now lets create a policy to change the Local_Pref value to ",(0,r.jsx)(n.strong,{children:"200"})," and observe the impact."]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Change the the Local_Pref for all inbounds routes"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"jcluser@vMX3# show policy-options \npolicy-statement SET_LOCAL_PREF {\n    term ROUTE {\n        from next-hop 10.100.35.2;\n        then {\n            local-preference 200;\n            accept;\n        }\n    }\n}\n"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"Change the the Local_Pref for a specific inbound route."}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"jcluser@vMX3# show policy-options \npolicy-statement SET_LOCAL_PREF {\n    term ROUTE {\n        from {\n            route-filter 192.168.235.0/24 exact;\n        }\n        then {\n            local-preference 200;\n            accept;\n        }\n    }\n}\n"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["Apply the policy inbound (",(0,r.jsx)(n.strong,{children:"import"}),") to change the AS exit point."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"jcluser@vMX3# show protocols bgp group to-AS64544 \ntype external;\nimport SET_LOCAL_PREF; <-- Inbound \npeer-as 64544;\nneighbor 10.100.35.2;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"the-result",children:"The Result"}),"\n",(0,r.jsx)(n.p,{children:"After applying the policy vMX1 chooses the route learned from vMX3 because of the higher Local_Pref value."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"jcluser@vMX1# run show route 192.168.235.0/24 exact detail    \n\ninet.0: 13 destinations, 13 routes (13 active, 0 holddown, 0 hidden)\n192.168.235.0/24 (1 entry, 1 announced)\n        *BGP    Preference: 170/-201\n                Next hop type: Indirect, Next hop index: 0\n                Address: 0xc4b5e8c\n                Next-hop reference count: 2\n                Source: 10.100.100.3\n                Next hop type: Router, Next hop index: 343\n                Next hop: 100.123.0.1 via fxp0.0, selected\n                Session Id: 0x0\n                Protocol next hop: 10.100.35.2\n                Indirect next hop: 0xc61e004 348 INH Session ID: 0x0\n                State: <Active Int Ext>\n                Local AS: 64522 Peer AS: 64522\n                Age: 13 Metric2: 0 \n                Validation State: unverified \n                Task: BGP_64522.10.100.100.3\n                Announcement bits (2): 0-KRT 5-Resolve tree 1 \n                AS path: 64544 I \n                Accepted\n                Localpref: 200 <--- Higher than the default \n                Router ID: 10.100.100.3\n                Thread: junos-main \n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"jcluser@vMX1# run show route protocol bgp   \n\ninet.0: 13 destinations, 13 routes (13 active, 0 holddown, 0 hidden)\n+ = Active Route, - = Last Active, * = Both\n\n192.168.235.0/24   *[BGP/170] 00:01:32, localpref 200, from 10.100.100.3\n                      AS path: 64544 I, validation-state: unverified\n                    >  to 100.123.0.1 via fxp0.0\n"})}),"\n",(0,r.jsx)(n.h3,{id:"advertise-to-ebgp-non-transitive",children:"Advertise to eBGP (non-transitive)"}),"\n",(0,r.jsxs)(n.p,{children:["vMX3 has the route ",(0,r.jsx)(n.strong,{children:"192.168.123.0/24"})," with ",(0,r.jsx)(n.strong,{children:"localpref"})," of  ",(0,r.jsx)(n.strong,{children:"123"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"jcluser@vMX3# run show route protocol bgp                         \n\ninet.0: 19 destinations, 20 routes (19 active, 0 holddown, 0 hidden)\n+ = Active Route, - = Last Active, * = Both\n\n192.168.123.0/24    [BGP/170] 00:04:39, localpref 123, from 10.100.100.1\n                      AS path: I, validation-state: unverified\n                    >  to 10.100.13.1 via ge-0/0/4.0\n192.168.235.0/24   *[BGP/170] 00:53:00, localpref 200\n                      AS path: 64544 I, validation-state: unverified\n                    >  to 10.100.35.2 via ge-0/0/0.0\n"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"When the route is advertised to a neighbor with a diffrent AS."}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"jcluser@vMX3# run show route advertising-protocol bgp 10.100.35.2 \n\ninet.0: 19 destinations, 20 routes (19 active, 0 holddown, 0 hidden)\n  Prefix  Nexthop       MED     Lclpref    AS path\n* 192.168.123.0/24        Self                 1                  I\n"})}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"The Local Preference resets back to the default value."}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"jcluser@vMX5# run show route protocol bgp detail\n\ninet.0: 17 destinations, 17 routes (17 active, 0 holddown, 0 hidden)\n192.168.123.0/24 (1 entry, 1 announced)\n        *BGP    Preference: 170/-101\n                Next hop type: Router, Next hop index: 596\n                Address: 0xc4b5f5c\n                Next-hop reference count: 2\n                Source: 10.100.35.1\n                Next hop: 10.100.35.1 via ge-0/0/0.0, selected\n                Session Id: 0x141\n                State: <Active Ext>\n                Local AS: 64544 Peer AS: 64522\n                Age: 1:56 Metric: 1 \n                Validation State: unverified \n                Task: BGP_64522.10.100.35.1\n                Announcement bits (3): 0-KRT 4-BGP_RT_Background \n                                       5-Resolve tree 1 \n                AS path: 64522 I \n                Accepted\n                Localpref: 100 <-- Original Value\n                Router ID: 10.100.100.3\n                Thread: junos-main \n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);